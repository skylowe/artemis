# ARTEMIS Configuration: TR2025 Intermediate Assumptions
# Source: SSA Office of the Chief Actuary, 2025 Trustees Report

metadata:
  trustees_report_year: 2025
  alternative: "Intermediate"
  alternative_number: 2
  projection_period:
    start_year: 2023  # Changed from 2024 to include TR2025's estimated 2023 immigration
    end_year: 2099
  valuation_date: "2025-01-01"

fertility:
  # Ultimate cohort TFR assumption
  ultimate_ctfr: 1.90
  # Cohort that first achieves ultimate CTFR
  ultimate_cohort_year: 2020
  # Age range for fertility calculations
  min_fertility_age: 14
  max_fertility_age: 49
  # Reference age for ratio calculations
  reference_age: 30
  # Ultimate attainment years
  projection_start_year: 2025
  # TR2025: Ultimate period TFR reached in 2045
  ultimate_year: 2045
  # TR2025: Age 30 reaches ultimate in 2036
  age30_ultimate_year: 2036
  # Interpolation weight exponent (TR2025 uses 1.5)
  # 1.0 = linear, >1 = front-loaded (faster initial change)
  weight_exponent: 1
  # Base year for projections
  # TR2025 uses 2024 with estimated rates (TFR=1.62 from provisional data)
  rate_base_year: 2024
  # Constrain TFR for specified years to match TR2025's published values
  # TR2025 publishes TFR=1.62 for 2023 and constrains 2024 to TFR=1.62.
  # When enabled, this scales age-specific rates proportionally for each year
  # to hit the target TFR exactly.
  # Format: year: target_tfr
  # Set to empty map {} or null to disable constraints
  constrain_tfr:
    2023: 1.62
    2024: 1.62
  # Years to exclude from trend calculations
  exclude_years:
    - 1997  # NCHS age imputation method change
  # TR2025 birth substitution
  # TR2025 assumed higher births for 2023-2024 than actual NCHS data shows.
  # This option substitutes TR2025's implied births (derived from their age 0
  # population adjusted for infant mortality) for the specified years.
  use_tr2025_births_for_years:
    - 2023
    - 2024

mortality:
  # Projection parameters
  base_year: 2019  # Last pre-COVID year used for starting values
  projection_start_year: 2020

  # Regression parameters (for calculating historical AAx)
  regression_start_year: 2008
  regression_end_year: 2019
  regression_weights:
    # Weights for 12-year regression period
    # Years 1-4: 0.2, 0.4, 0.6, 0.8
    # Years 5-10: 1.0 each
    # Years 11-12: 2.0, 3.0
    year_1: 0.2
    year_2: 0.4
    year_3: 0.6
    year_4: 0.8
    year_5_10: 1.0
    year_11: 2.0
    year_12: 3.0
  negative_aax_factor: 0.75  # Multiply negative AAx by this factor for starting values

  # Transition parameters
  transition_rate: 0.80  # 80% of remaining difference each year
  transition_years: 24   # Years until ultimate values reached
  ultimate_year: 2043    # base_year + transition_years = 2019 + 24

  # =========================================================================
  # Starting AAx Method Configuration
  # =========================================================================
  # Controls how starting values are determined for the mortality projection.
  #
  # Options:
  #   "regression" - Use historical regression-based AAx (original implementation)
  #                  Calculates starting AAx from weighted regression on 2008-2019 data
  #   "capped"     - Cap starting AAx at a multiple of ultimate AAx
  #                  Prevents unrealistically high starting improvement rates
  #   "tr_qx"      - Use TR2025's actual qx values as starting point
  #                  Both starting qx AND starting AAx come from TR2025 files
  #                  Ensures full alignment with TR2025 mortality trajectory
  # =========================================================================
  starting_aax_method: "tr_qx"  # Options: "regression", "capped", "tr_qx"

  # Configuration for "capped" method
  starting_aax_cap:
    multiplier: 1.5  # Cap starting AAx at this multiple of ultimate AAx
    # Example: If ultimate AAx is 0.5%, cap starting at 0.75% (1.5 Ã— 0.5%)

  # Configuration for "tr_qx" method
  starting_tr_qx:
    # Path to TR2025 death probability files (relative to project root)
    # Projected files (2023-2100)
    male_qx_file: "data/raw/SSA_TR2025/DeathProbsE_M_Alt2_TR2025.csv"
    female_qx_file: "data/raw/SSA_TR2025/DeathProbsE_F_Alt2_TR2025.csv"
    # Historical files (1900-2022)
    male_qx_hist_file: "data/raw/SSA_TR2025/DeathProbsE_M_Hist_TR2025.csv"
    female_qx_hist_file: "data/raw/SSA_TR2025/DeathProbsE_F_Hist_TR2025.csv"
    # Base year for starting qx (2023 = first year TR2025 projected file covers)
    base_year: 2023
    # Years to use for calculating implied AAx (2024-2025 gives first year improvement)
    aax_reference_years: [2024, 2025]

  # Whittaker-Henderson smoothing parameters (per SSA documentation)
  whittaker_henderson:
    degree: 2           # d parameter (difference order)
    smoothing_param: 0.01  # lambda parameter
    age_range_min: 2
    age_range_max: 99

  # Age-specific parameters for ages 100+
  very_old_age:
    start_age: 100
    male_growth_rate: 1.05    # 5% annual increase in qx
    female_growth_rate: 1.06  # 6% annual increase in qx
    transition_ages: [100, 101, 102, 103, 104]  # Transition from q99/q98 ratio to growth rate

  # COVID-19 adjustment factors (applied to qx in 2024-2025)
  covid_adjustments:
    2024:
      age_0: 1.01
      age_1_14: 1.17
      age_15_64: 0.99
      age_65_84: 1.02
      age_85_plus: 0.98
    2025:
      age_0: 1.00
      age_1_14: 1.09
      age_15_64: 1.00
      age_65_84: 1.00
      age_85_plus: 1.00

  # =========================================================================
  # Ultimate Annual Percentage Reductions (AAx) by Age Group and Cause
  # =========================================================================
  # These are the long-term assumed rates of mortality improvement.
  # Values are percentages (e.g., 1.9 = 1.9% annual reduction in death rates)
  # Source: TR2025 Appendix 1.2-1, Intermediate Assumptions
  #
  # To customize: modify these values or create alternative config files
  # (e.g., tr2025_low_cost.yaml, tr2025_high_cost.yaml)
  # =========================================================================

  ultimate_aax:
    # Age group: Under 15 (ages 0-14)
    under_15:
      CVD: 1.9   # Cardiovascular disease
      CAN: 1.5   # Cancer (malignant neoplasms)
      ACV: 1.0   # Accidents and violence
      RES: 2.0   # Respiratory disease
      DEM: 0.1   # Dementia
      OTH: 1.7   # All other causes

    # Age group: 15-49
    age_15_49:
      CVD: 1.3
      CAN: 1.5
      ACV: 0.7
      RES: 0.5
      DEM: 0.1
      OTH: 0.8

    # Age group: 50-64
    age_50_64:
      CVD: 1.5
      CAN: 1.5
      ACV: 0.5
      RES: 0.7
      DEM: 0.1
      OTH: 0.6

    # Age group: 65-84
    age_65_84:
      CVD: 1.9
      CAN: 0.9
      ACV: 0.5
      RES: 0.3
      DEM: 0.1
      OTH: 0.3

    # Age group: 85+ (ages 85-119)
    age_85_plus:
      CVD: 1.5
      CAN: 0.5
      ACV: 0.3
      RES: 0.2
      DEM: 0.1
      OTH: 0.3

  # Age group boundaries for ultimate AAx
  age_groups:
    under_15:
      min_age: 0
      max_age: 14
    age_15_49:
      min_age: 15
      max_age: 49
    age_50_64:
      min_age: 50
      max_age: 64
    age_65_84:
      min_age: 65
      max_age: 84
    age_85_plus:
      min_age: 85
      max_age: 119

  # Cause of death categories (ICD-10 mapping)
  causes:
    CVD:
      name: "Cardiovascular Disease"
      description: "Heart disease and cerebrovascular disease"
    CAN:
      name: "Cancer"
      description: "Malignant neoplasms"
    ACV:
      name: "Accidents and Violence"
      description: "Unintentional injuries and intentional self-harm/assault"
    RES:
      name: "Respiratory Disease"
      description: "Chronic lower respiratory diseases, influenza, pneumonia"
    DEM:
      name: "Dementia"
      description: "Alzheimer's disease and other dementias"
    OTH:
      name: "All Other Causes"
      description: "All causes not included above"

immigration:
  # =========================================================================
  # LPR Immigration Configuration (TR2025 Intermediate Assumptions)
  # =========================================================================
  # Source: SSA 2025 Long-Range Model Documentation, Section 1.3

  lpr:
    # Projection parameters
    projection_start_year: 2025

    # Total LPR immigration assumptions (TR2025 Intermediate)
    # These are gross immigration (before emigration)
    total_lpr:
      2024: 1263000
      2025: 1213000
      2026: 1213000
      ultimate: 1050000
      ultimate_year: 2027

    # Age range for immigration
    min_age: 0
    max_age: 99

    # =========================================================================
    # Age-Sex Distribution Method
    # =========================================================================
    # Controls how immigration is distributed across ages and sexes.
    #
    # Options:
    #   "dhs" - Uses DHS expanded tables with Beers interpolation to distribute
    #           LPR immigration by age and sex. Based on actual LPR admission data.
    #   "calibrated" - Uses distribution calibrated via optimization to minimize
    #                  population projection error vs TR2025. Shifts weight toward
    #                  younger ages compared to DHS. Loaded from:
    #                  data/processed/calibrated_lpr_distribution.csv
    # =========================================================================
    distribution_method: "calibrated"

    # DHS distribution configuration
    dhs_distribution:
      distribution_years: [2018, 2019, 2020, 2021, 2022, 2023]

    # Reference years for distribution calculation
    distribution_years: [2018, 2019, 2020, 2021, 2022, 2023]

    # NEW/AOS split method:
    # - "assumption": Use TR2025 V.A2 values directly (450K AOS, recommended)
    # - "ratio": Use historical ratio from DHS data (produces ~533K-616K AOS)
    new_aos_split_method: "assumption"

    # NEW/AOS ratio source and reference years (DHS aggregate data)
    # Only used when new_aos_split_method = "ratio"
    # Ratio calculated from DHS 2016-2019 (excluding COVID-affected 2020)
    new_aos_ratio_source: "dhs"
    new_aos_ratio_years: [2016, 2017, 2018, 2019]

    # Fiscal-to-calendar year conversion method
    fiscal_to_calendar_method: "simple"  # or "weighted" (requires quarterly data)

  # =========================================================================
  # Legal Emigration Configuration
  # =========================================================================

  emigration:
    # Emigration ratio (percent of LPR immigration that emigrates)
    ratio: 0.25  # 25% per TR2025

    # Distribution source
    # Uses same DHS age-sex distribution as immigration since DHS does not
    # provide emigration-specific data. TR uses Census 1980-1990 estimates.
    distribution_source: "dhs"
    distribution_years: [2018, 2019, 2020, 2021, 2022, 2023]

  # Net LPR immigration = gross LPR - emigration = 75% of gross LPR
  # 2024: 947,250 (75% of 1,263,000)
  # 2025-26: 909,750 (75% of 1,213,000)
  # 2027+: 787,500 (75% of 1,050,000)
  ultimate_net_lpr_immigration: 787500

  # =========================================================================
  # O (Other/Temp/Unlawful) Immigration Configuration
  # =========================================================================
  # Controls whether O emigration is calculated dynamically (grows with stock)
  # or uses a constant net O assumption matching TR2025 Table V.A2

  o_immigration:
    # Gross O immigration (ultimate, from 2026+)
    # TR2025: 1,350,000 for unauthorized + nonimmigrant arrivals
    ultimate_gross_o: 1350000

    # Transition year gross (2025 only - higher due to policy assumptions)
    transition_gross_o: 2000000

    # Dynamic emigration toggle:
    # - true: Emigration grows with O population stock (more realistic)
    # - false: Use constant net O assumption (matches TR2025 exactly)
    dynamic_emigration: false

    # Ultimate net O immigration (used when dynamic_emigration = false)
    # TR2025 Table V.A2: 550,000 net other immigration per year
    ultimate_net_o: 550000

    # Transition net O (2025 only)
    # Higher in first year due to policy assumptions
    transition_net_o: 1250000

# =========================================================================
# Marriage Configuration (TR2025 Intermediate Assumptions)
# =========================================================================
# Source: SSA 2025 Long-Range Model Documentation, Section 1.6

marriage:
  # Ultimate age-adjusted marriage rate (AMR)
  # Per 100,000 unmarried couples (geometric mean of male and female)
  ultimate_amr: 4000

  # Year when ultimate AMR is reached (year 25 from first projection year)
  # 2023 + 24 = 2047
  ultimate_year: 2047

  # Starting rate calculation (weighted average of historical years)
  starting_rate_years: 5  # Last 5 years of historical data
  starting_rate_weights: "linear"  # More recent years weighted higher

  # Age range for MarGrid
  min_age: 14
  max_age: 100  # 100+ grouped into single age

  # Historical data periods
  historical_periods:
    detailed_nchs_start: 1978
    detailed_nchs_end: 1988
    nchs_subset_start: 1989
    nchs_subset_end: 1995
    interpolation_start: 1996
    interpolation_end: 2007
    acs_start: 2008
    acs_end: 2022

  # Years for prior marital status differentials
  prior_status_years: [1979, 1981, 1982, 1983, 1984, 1985, 1986, 1987, 1988]

  # Same-sex marriage configuration
  # NOTE: TR2025 uses state-level data (2004-2012) we don't have access to
  # We use ACS PUMS (2015-2022) instead - documented methodology deviation
  same_sex:
    data_source: "acs"  # "acs" or "state" (state data not available)
    reference_years: [2015, 2016, 2017, 2018, 2019]

  # Standard population year for AMR calculation
  standard_population_year: 2010

# Divorce Configuration (TR2025 Intermediate Assumptions)
# =========================================================================
# Source: SSA 2025 Long-Range Model Documentation, Section 1.7

divorce:
  # Ultimate age-adjusted divorce rate (ADR)
  # Per 100,000 married couples
  ultimate_adr: 1700

  # Year when ultimate ADR is reached (year 25 from first projection year)
  # 2023 + 24 = 2047
  ultimate_year: 2047

  # Starting rate calculation (weighted average of historical years)
  starting_rate_years: 5  # Last 5 years of historical data
  starting_rate_weights: "linear"  # More recent years weighted higher

  # Age range for DivGrid
  min_age: 14
  max_age: 100  # 100+ grouped into single age

  # Historical data periods
  historical_periods:
    detailed_nchs_start: 1979
    detailed_nchs_end: 1988
    totals_start: 1989
    totals_end: 2022
    acs_adjustment_start: 2008
    acs_adjustment_end: 2022

  # Standard population for ADR calculation
  # Per TR2025: "averaged 2009 and 2010 December 31 marriage grids"
  standard_population_years: [2009, 2010]

# =========================================================================
# Projected Population Configuration (TR2025 Section 1.8)
# =========================================================================
# Source: SSA 2025 Long-Range Model Documentation, Section 1.8

projected_population:
  # Time period
  starting_year: 2022  # December 31 basis
  projection_start: 2023
  projection_end: 2099
  extended_end: 2105  # For some outputs needing longer projection

  # Use TR2025 historical population instead of our calculated historical population
  # This is useful for testing to isolate projection methodology differences
  # from historical population estimation differences
  use_tr_historical_population: true
  tr_historical_population_file: "data/raw/SSA_TR2025/SSPopDec_Alt2_TR2025.csv"

  # Reference date for population stocks
  reference_date: "dec31"  # December 31

  # Sex ratio at birth (males per 1000 females)
  # TR2025: "a sex ratio of 1,048 male births for every 1,000 female births"
  sex_ratio_at_birth: 1048

  # Population status parameters (for same-sex marriage modeling)
  # TR2025: "2.5% of the male population and 4.5% of the female population
  # is gay or lesbian"
  population_status:
    gay_percent: 0.025      # 2.5% of male population
    lesbian_percent: 0.045  # 4.5% of female population
    same_sex_start_year: 2013  # Federal recognition year

  # Age ranges
  ages:
    min_age: 0
    max_age: 100           # Maximum single year of age tracked (100 represents 100+)
    max_age_group: 100     # Open-ended age group (100+)
    mothers_min: 14        # Minimum mother's age for births
    mothers_max: 49        # Maximum mother's age for births
    children_max: 18       # Maximum age for "children" category
    marriage_min: 14       # Minimum marriage age

  # Marital status categories
  marital_statuses:
    # For total population (4 categories)
    total_population:
      - single
      - married
      - widowed
      - divorced
    # For CNI population (5 categories - includes separated)
    cni_population:
      - single
      - married_spouse_present
      - separated
      - widowed
      - divorced

  # Parent fate categories (for children ages 0-18)
  parent_fates:
    - both_alive
    - only_father_alive
    - only_mother_alive
    - both_deceased

  # Parent age groups for children classification
  parent_age_groups:
    - [14, 24]
    - [25, 34]
    - [35, 44]
    - [45, 54]
    - [55, 64]
    - [65, 100]

  # Armed forces assumptions
  # TR2025: "subtracting an assumed constant number of armed forces overseas"
  armed_forces:
    hold_constant: true
    reference_year: 2022

  # CNI/civilian ratios
  # TR2025: "applying the ratios of CNI population to civilian population
  # by year, sex, and single year of age in the starting year"
  cni_ratios:
    hold_constant: true
    reference_year: 2022

  # Mortality differentials by marital status
  # TR2025: "relative differences in death rates by marital status observed
  # for that age and sex during the calendar years 2015-2019"
  mortality_differentials:
    reference_years: [2015, 2016, 2017, 2018, 2019]
    apply_to_projection: true

  # Children per couple projection parameters
  children_regression:
    historical_years: [1962, 2022]
    projection_method: "linear"
    trend_years: 20  # Last N years for trend calculation

# Data source configuration
data_sources:
  historical_birth_data:
    start_year: 1980
    end_year: 2023
  historical_rate_data:
    start_year: 1917
    end_year: 1979
  population_estimates:
    start_year: 1980
    end_year: 2024
  # Census Bureau population estimates vintage
  # 2024: Latest data with 2020 Census revisions (default)
  # 2023: Earlier vintage, closer to what TR2025 used for 2020-2022
  # Note: Both vintages incorporate 2020 Census baseline, so 2019+ will
  # differ from TR2025 which used pre-2020 Census estimates
  census_vintage: 2024

  # =========================================================================
  # Census Undercount Methodology
  # =========================================================================
  # Controls which undercount factors are applied to Census population estimates
  # to derive the Social Security area population.
  #
  # Options:
  # - "DA": Demographic Analysis (Census Bureau official, single-year-of-age)
  #         Shows ages 18-24 OVERCOUNTED by ~3-8% in 2020 Census
  #         More methodologically rigorous; uses birth/death records
  #
  # - "PES": Post-Enumeration Survey based factors (hardcoded below)
  #          Shows ages 18-29 UNDERCOUNTED by ~1-2%
  #          Better matches TR2025 population; excludes college dorms
  #
  # TR2025 appears to use factors closer to PES methodology, resulting in
  # higher population for ages 18-24 than Census DA would suggest.
  census_undercount_method: "none"

  # PES-based undercount factors by age group (used when census_undercount_method = "PES")
  # Source: Census Bureau Post-Enumeration Survey, 2020 Census
  # Reference: https://www.census.gov/newsroom/press-releases/2022/2020-census-estimates-of-undercount-and-overcount.html
  #
  # Note: PES found statistically significant undercounts for males 18-29 (2.25%)
  # and females 18-29 (0.98%). These differ from DA because PES excludes
  # group quarters like college dorms.
  pes_undercount_factors:
    # Age group: rate (positive = undercount, negative = overcount)
    age_0_4: 0.055       # 5.5% undercount (both DA and PES agree on young children)
    age_5_9: 0.010       # 1.0% undercount
    age_10_17: 0.005     # 0.5% undercount
    age_18_29_male: 0.015   # 2.25% undercount (PES finding)
    age_18_29_female: 0.0098 # 0.98% undercount (PES finding)
    age_30_49_male: 0.01   # 1.5% undercount (estimated)
    age_30_49_female: 0.005  # 0.5% undercount (estimated)
    age_50_plus: -0.005  # 0.5% overcount (slight overcount for older ages)
